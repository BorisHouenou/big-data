<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Text mining with sparklyr | _main.utf8</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Text mining with sparklyr | _main.utf8" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Text mining with sparklyr | _main.utf8" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro-to-sparklyr.html"/>
<link rel="next" href="spark-data-caching.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Big Data with R - Exercise book</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-vroom.html"><a href="introduction-to-vroom.html"><i class="fa fa-check"></i><b>1</b> Introduction to <code>vroom</code></a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-vroom.html"><a href="introduction-to-vroom.html#vroom-basics"><i class="fa fa-check"></i><b>1.1</b> <code>vroom</code> basics</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-vroom.html"><a href="introduction-to-vroom.html#load-multiple-files"><i class="fa fa-check"></i><b>1.2</b> Load multiple files</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-vroom.html"><a href="introduction-to-vroom.html#load-and-modify-multiple-files"><i class="fa fa-check"></i><b>1.3</b> Load and modify multiple files</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-dtplyr.html"><a href="introduction-to-dtplyr.html"><i class="fa fa-check"></i><b>2</b> Introduction to <code>dtplyr</code></a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-dtplyr.html"><a href="introduction-to-dtplyr.html#dtplyr-basics"><i class="fa fa-check"></i><b>2.1</b> <code>dtplyr</code> basics</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-dtplyr.html"><a href="introduction-to-dtplyr.html#object-sizes"><i class="fa fa-check"></i><b>2.2</b> Object sizes</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-dtplyr.html"><a href="introduction-to-dtplyr.html#how-dtplyr-works"><i class="fa fa-check"></i><b>2.3</b> How <code>dtplyr</code> works</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-dtplyr.html"><a href="introduction-to-dtplyr.html#working-with-dtplyr"><i class="fa fa-check"></i><b>2.4</b> Working with <code>dtplyr</code></a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-dtplyr.html"><a href="introduction-to-dtplyr.html#pivot-data"><i class="fa fa-check"></i><b>2.5</b> Pivot data</a></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-dtplyr.html"><a href="introduction-to-dtplyr.html#the-mutate-verb"><i class="fa fa-check"></i><b>2.6</b> The <code>mutate()</code> verb</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-database-connections.html"><a href="introduction-to-database-connections.html"><i class="fa fa-check"></i><b>3</b> Introduction to database connections</a><ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-database-connections.html"><a href="introduction-to-database-connections.html#connecting-via-dsn"><i class="fa fa-check"></i><b>3.1</b> Connecting via DSN</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-database-connections.html"><a href="introduction-to-database-connections.html#connect-with-a-connection-string"><i class="fa fa-check"></i><b>3.2</b> Connect with a connection string</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-database-connections.html"><a href="introduction-to-database-connections.html#secure-connection-details"><i class="fa fa-check"></i><b>3.3</b> Secure connection details</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="introduction-to-dbi.html"><a href="introduction-to-dbi.html"><i class="fa fa-check"></i><b>4</b> Introduction to <code>DBI</code></a><ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-dbi.html"><a href="introduction-to-dbi.html#local-database-basics"><i class="fa fa-check"></i><b>4.1</b> Local database basics</a></li>
<li class="chapter" data-level="4.2" data-path="introduction-to-dbi.html"><a href="introduction-to-dbi.html#options-for-writing-tables"><i class="fa fa-check"></i><b>4.2</b> Options for writing tables</a></li>
<li class="chapter" data-level="4.3" data-path="introduction-to-dbi.html"><a href="introduction-to-dbi.html#database-operations"><i class="fa fa-check"></i><b>4.3</b> Database operations</a></li>
<li class="chapter" data-level="4.4" data-path="introduction-to-dbi.html"><a href="introduction-to-dbi.html#knitr-sql-engine"><i class="fa fa-check"></i><b>4.4</b> <code>knitr</code> SQL engine</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="databases-and-dplyr.html"><a href="databases-and-dplyr.html"><i class="fa fa-check"></i><b>5</b> Databases and <code>dplyr</code></a><ul>
<li class="chapter" data-level="5.1" data-path="databases-and-dplyr.html"><a href="databases-and-dplyr.html#intro-to-connections"><i class="fa fa-check"></i><b>5.1</b> Intro to <code>connections</code></a></li>
<li class="chapter" data-level="5.2" data-path="databases-and-dplyr.html"><a href="databases-and-dplyr.html#table-reference"><i class="fa fa-check"></i><b>5.2</b> Table reference</a></li>
<li class="chapter" data-level="5.3" data-path="databases-and-dplyr.html"><a href="databases-and-dplyr.html#under-the-hood"><i class="fa fa-check"></i><b>5.3</b> Under the hood</a></li>
<li class="chapter" data-level="5.4" data-path="databases-and-dplyr.html"><a href="databases-and-dplyr.html#un-translated-r-commands"><i class="fa fa-check"></i><b>5.4</b> Un-translated R commands</a></li>
<li class="chapter" data-level="5.5" data-path="databases-and-dplyr.html"><a href="databases-and-dplyr.html#using-bang-bang"><i class="fa fa-check"></i><b>5.5</b> Using bang-bang</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-visualizations.html"><a href="data-visualizations.html"><i class="fa fa-check"></i><b>6</b> Data Visualizations</a><ul>
<li class="chapter" data-level="6.1" data-path="data-visualizations.html"><a href="data-visualizations.html#simple-plot"><i class="fa fa-check"></i><b>6.1</b> Simple plot</a></li>
<li class="chapter" data-level="6.2" data-path="data-visualizations.html"><a href="data-visualizations.html#plot-in-one-code-segment"><i class="fa fa-check"></i><b>6.2</b> Plot in one code segment</a></li>
<li class="chapter" data-level="6.3" data-path="data-visualizations.html"><a href="data-visualizations.html#create-a-histogram"><i class="fa fa-check"></i><b>6.3</b> Create a histogram</a></li>
<li class="chapter" data-level="6.4" data-path="data-visualizations.html"><a href="data-visualizations.html#raster-plot"><i class="fa fa-check"></i><b>6.4</b> Raster plot</a></li>
<li class="chapter" data-level="6.5" data-path="data-visualizations.html"><a href="data-visualizations.html#using-the-compute-functions"><i class="fa fa-check"></i><b>6.5</b> Using the <code>compute</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modeling-with-databases.html"><a href="modeling-with-databases.html"><i class="fa fa-check"></i><b>7</b> Modeling with databases</a><ul>
<li class="chapter" data-level="7.1" data-path="modeling-with-databases.html"><a href="modeling-with-databases.html#single-step-sampling"><i class="fa fa-check"></i><b>7.1</b> Single step sampling</a></li>
<li class="chapter" data-level="7.2" data-path="modeling-with-databases.html"><a href="modeling-with-databases.html#using-tidymodels-for-modeling"><i class="fa fa-check"></i><b>7.2</b> Using <code>tidymodels</code> for modeling</a></li>
<li class="chapter" data-level="7.3" data-path="modeling-with-databases.html"><a href="modeling-with-databases.html#score-with-tidypredict"><i class="fa fa-check"></i><b>7.3</b> Score with <code>tidypredict</code></a></li>
<li class="chapter" data-level="7.4" data-path="modeling-with-databases.html"><a href="modeling-with-databases.html#run-predictions-in-db"><i class="fa fa-check"></i><b>7.4</b> Run predictions in DB</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="advanced-operations.html"><a href="advanced-operations.html"><i class="fa fa-check"></i><b>8</b> Advanced Operations</a><ul>
<li class="chapter" data-level="8.1" data-path="advanced-operations.html"><a href="advanced-operations.html#simple-wrapper-function"><i class="fa fa-check"></i><b>8.1</b> Simple wrapper function</a></li>
<li class="chapter" data-level="8.2" data-path="advanced-operations.html"><a href="advanced-operations.html#multiple-variables"><i class="fa fa-check"></i><b>8.2</b> Multiple variables</a></li>
<li class="chapter" data-level="8.3" data-path="advanced-operations.html"><a href="advanced-operations.html#multiple-queries"><i class="fa fa-check"></i><b>8.3</b> Multiple queries</a></li>
<li class="chapter" data-level="8.4" data-path="advanced-operations.html"><a href="advanced-operations.html#multiple-queries-with-an-overlapping-range"><i class="fa fa-check"></i><b>8.4</b> Multiple queries with an overlapping range</a></li>
<li class="chapter" data-level="8.5" data-path="advanced-operations.html"><a href="advanced-operations.html#characters-to-field-names"><i class="fa fa-check"></i><b>8.5</b> Characters to field names</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html"><i class="fa fa-check"></i><b>9</b> Intro to <code>sparklyr</code></a><ul>
<li class="chapter" data-level="9.1" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#new-spark-session"><i class="fa fa-check"></i><b>9.1</b> New Spark session</a></li>
<li class="chapter" data-level="9.2" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#data-transfer"><i class="fa fa-check"></i><b>9.2</b> Data transfer</a></li>
<li class="chapter" data-level="9.3" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#spark-and-dplyr"><i class="fa fa-check"></i><b>9.3</b> Spark and <code>dplyr</code></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html"><i class="fa fa-check"></i><b>10</b> Text mining with <code>sparklyr</code></a><ul>
<li class="chapter" data-level="10.1" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#data-import"><i class="fa fa-check"></i><b>10.1</b> Data Import</a></li>
<li class="chapter" data-level="10.2" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#tidying-data"><i class="fa fa-check"></i><b>10.2</b> Tidying data</a></li>
<li class="chapter" data-level="10.3" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#transform-the-data"><i class="fa fa-check"></i><b>10.3</b> Transform the data</a></li>
<li class="chapter" data-level="10.4" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#data-exploration"><i class="fa fa-check"></i><b>10.4</b> Data Exploration</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="spark-data-caching.html"><a href="spark-data-caching.html"><i class="fa fa-check"></i><b>11</b> Spark data caching</a><ul>
<li class="chapter" data-level="11.1" data-path="spark-data-caching.html"><a href="spark-data-caching.html#map-data"><i class="fa fa-check"></i><b>11.1</b> Map data</a></li>
<li class="chapter" data-level="11.2" data-path="spark-data-caching.html"><a href="spark-data-caching.html#caching-data"><i class="fa fa-check"></i><b>11.2</b> Caching data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="text-mining-with-sparklyr" class="section level1">
<h1><span class="header-section-number">10</span> Text mining with <code>sparklyr</code></h1>
<p>For this example, there are two files that will be analyzed. They are both the full works of Sir Arthur Conan Doyle and Mark Twain. The files were downloaded from the <a href="https://www.gutenberg.org/">Gutenberg Project</a> site via the <code>gutenbergr</code> package. Intentionally, no data cleanup was done to the files prior to this analysis. See the appendix below to see how the data was downloaded and prepared.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb323-1" data-line-number="1"><span class="kw">readLines</span>(<span class="st">&quot;/usr/share/class/books/arthur_doyle.txt&quot;</span>, <span class="dv">30</span>) </a></code></pre></div>
<pre><code>##  [1] &quot;THE RETURN OF SHERLOCK HOLMES,&quot;                  
##  [2] &quot;&quot;                                                
##  [3] &quot;A Collection of Holmes Adventures&quot;               
##  [4] &quot;&quot;                                                
##  [5] &quot;&quot;                                                
##  [6] &quot;by Sir Arthur Conan Doyle&quot;                       
##  [7] &quot;&quot;                                                
##  [8] &quot;&quot;                                                
##  [9] &quot;&quot;                                                
## [10] &quot;&quot;                                                
## [11] &quot;CONTENTS:&quot;                                       
## [12] &quot;&quot;                                                
## [13] &quot;     The Adventure Of The Empty House&quot;           
## [14] &quot;&quot;                                                
## [15] &quot;     The Adventure Of The Norwood Builder&quot;       
## [16] &quot;&quot;                                                
## [17] &quot;     The Adventure Of The Dancing Men&quot;           
## [18] &quot;&quot;                                                
## [19] &quot;     The Adventure Of The Solitary Cyclist&quot;      
## [20] &quot;&quot;                                                
## [21] &quot;     The Adventure Of The Priory School&quot;         
## [22] &quot;&quot;                                                
## [23] &quot;     The Adventure Of Black Peter&quot;               
## [24] &quot;&quot;                                                
## [25] &quot;     The Adventure Of Charles Augustus Milverton&quot;
## [26] &quot;&quot;                                                
## [27] &quot;     The Adventure Of The Six Napoleons&quot;         
## [28] &quot;&quot;                                                
## [29] &quot;     The Adventure Of The Three Students&quot;        
## [30] &quot;&quot;</code></pre>
<div id="data-import" class="section level2">
<h2><span class="header-section-number">10.1</span> Data Import</h2>
<p><em>Read the book data into Spark</em></p>
<ol style="list-style-type: decimal">
<li><p>Load the <code>sparklyr</code> library</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb325-1" data-line-number="1"><span class="kw">library</span>(sparklyr)</a></code></pre></div></li>
<li><p>Open a Spark session</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb326-1" data-line-number="1">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;local&quot;</span>)</a></code></pre></div>
<pre><code>## Re-using existing Spark connection to local</code></pre></li>
<li><p>Use the <code>spark_read_text()</code> function to read the <strong>mark_twain.txt</strong> file, assign it to a variable called <code>twain</code></p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb328-1" data-line-number="1">twain &lt;-<span class="st"> </span><span class="kw">spark_read_text</span>(sc, <span class="st">&quot;twain&quot;</span>, <span class="st">&quot;/usr/share/class/books/mark_twain.txt&quot;</span>) </a></code></pre></div></li>
<li><p>Use the <code>spark_read_text()</code> function to read the <strong>arthur_doyle.txt</strong> file, assign it to a variable called <code>doyle</code></p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb329-1" data-line-number="1">doyle &lt;-<span class="st"> </span><span class="kw">spark_read_text</span>(sc, <span class="st">&quot;doyle&quot;</span>, <span class="st">&quot;/usr/share/class/books/arthur_doyle.txt&quot;</span>) </a></code></pre></div></li>
</ol>
</div>
<div id="tidying-data" class="section level2">
<h2><span class="header-section-number">10.2</span> Tidying data</h2>
<p><em>Prepare the data for analysis</em></p>
<ol style="list-style-type: decimal">
<li><p>Load the <code>dplyr</code> library</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb330-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a></code></pre></div></li>
<li><p>Add a column to <code>twain</code> named <code>author</code> with a value of “twain”. Assign it to a new variable called <code>twain_id</code></p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb331-1" data-line-number="1">twain_id &lt;-<span class="st"> </span>twain <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb331-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">author =</span> <span class="st">&quot;twain&quot;</span>)</a></code></pre></div></li>
<li><p>Add a column to <code>doyle</code> named <code>author</code> with a value of “doyle”. Assign it to a new variable called <code>doyle_id</code></p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb332-1" data-line-number="1">doyle_id &lt;-<span class="st"> </span>doyle <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb332-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">author =</span> <span class="st">&quot;doyle&quot;</span>)</a></code></pre></div></li>
<li><p>Use <code>sdf_bind_rows()</code> to append the two files together in a variable called <code>both</code></p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb333-1" data-line-number="1">both &lt;-<span class="st"> </span>doyle_id <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-2" data-line-number="2"><span class="st">  </span><span class="kw">sdf_bind_rows</span>(twain_id) </a></code></pre></div></li>
<li><p>Preview <code>both</code></p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb334-1" data-line-number="1">both</a></code></pre></div>
<pre><code>## # Source: spark&lt;?&gt; [?? x 2]
##    line                                author
##    &lt;chr&gt;                               &lt;chr&gt; 
##  1 &quot;THE RETURN OF SHERLOCK HOLMES,&quot;    doyle 
##  2 &quot;&quot;                                  doyle 
##  3 &quot;A Collection of Holmes Adventures&quot; doyle 
##  4 &quot;&quot;                                  doyle 
##  5 &quot;&quot;                                  doyle 
##  6 &quot;by Sir Arthur Conan Doyle&quot;         doyle 
##  7 &quot;&quot;                                  doyle 
##  8 &quot;&quot;                                  doyle 
##  9 &quot;&quot;                                  doyle 
## 10 &quot;&quot;                                  doyle 
## # … with more rows</code></pre></li>
<li><p>Filter out empty lines into a variable called <code>all_lines</code></p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb336-1" data-line-number="1">all_lines &lt;-<span class="st"> </span>both <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb336-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">nchar</span>(line) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a></code></pre></div></li>
<li><p>Use Hive’s <em>regexp_replace</em> to remove punctuation, assign it to the same <code>all_lines</code> variable</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb337-1" data-line-number="1">all_lines &lt;-<span class="st"> </span>all_lines <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb337-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">line =</span> <span class="kw">regexp_replace</span>(line, <span class="st">&quot;[_</span><span class="ch">\&quot;\&#39;</span><span class="st">():;,.!?</span><span class="ch">\\</span><span class="st">-]&quot;</span>, <span class="st">&quot; &quot;</span>))</a></code></pre></div></li>
</ol>
</div>
<div id="transform-the-data" class="section level2">
<h2><span class="header-section-number">10.3</span> Transform the data</h2>
<p><em>Use feature transformers to make additional preparations</em></p>
<ol style="list-style-type: decimal">
<li><p>Use <code>ft_tokenizer()</code> to separate each word. in the line. Set the <code>output_col</code> to “word_list”. Assign to a variable called <code>word_list</code></p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" data-line-number="1">word_list &lt;-<span class="st"> </span>all_lines <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb338-2" data-line-number="2"><span class="st">    </span><span class="kw">ft_tokenizer</span>(</a>
<a class="sourceLine" id="cb338-3" data-line-number="3">      <span class="dt">input_col =</span> <span class="st">&quot;line&quot;</span>,</a>
<a class="sourceLine" id="cb338-4" data-line-number="4">      <span class="dt">output_col =</span> <span class="st">&quot;word_list&quot;</span></a>
<a class="sourceLine" id="cb338-5" data-line-number="5">      )</a></code></pre></div></li>
<li><p>Remove “stop words” with the <code>ft_stop_words_remover()</code> transformer. Set the <code>output_col</code> to “wo_stop_words”. Assign to a variable called <code>wo_stop</code></p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb339-1" data-line-number="1">wo_stop &lt;-<span class="st"> </span>word_list <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb339-2" data-line-number="2"><span class="st">  </span><span class="kw">ft_stop_words_remover</span>(</a>
<a class="sourceLine" id="cb339-3" data-line-number="3">    <span class="dt">input_col =</span> <span class="st">&quot;word_list&quot;</span>,</a>
<a class="sourceLine" id="cb339-4" data-line-number="4">    <span class="dt">output_col =</span> <span class="st">&quot;wo_stop_words&quot;</span></a>
<a class="sourceLine" id="cb339-5" data-line-number="5">    )</a></code></pre></div></li>
<li><p>Un-nest the tokens inside <em>wo_stop_words</em> using <code>explode()</code>. Assign to a variable called <code>exploded</code></p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" data-line-number="1">exploded &lt;-<span class="st"> </span>wo_stop <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb340-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">explode</span>(wo_stop_words))</a></code></pre></div></li>
<li><p>Select the <em>word</em> and <em>author</em> columns, and remove any word with less than 3 characters. Assign to <code>all_words</code></p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb341-1" data-line-number="1">all_words &lt;-<span class="st"> </span>exploded <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(word, author) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">nchar</span>(word) <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div></li>
<li><p>Cache the <code>all_words</code> variable using <code>compute()</code></p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb342-1" data-line-number="1">all_words &lt;-<span class="st"> </span>all_words <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb342-2" data-line-number="2"><span class="st">  </span><span class="kw">compute</span>(<span class="st">&quot;all_words&quot;</span>)</a></code></pre></div></li>
</ol>
</div>
<div id="data-exploration" class="section level2">
<h2><span class="header-section-number">10.4</span> Data Exploration</h2>
<p><em>Used word clouds to explore the data</em></p>
<ol style="list-style-type: decimal">
<li><p>Create a variable with the word count by author, name it <code>word_count</code></p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb343-1" data-line-number="1">word_count &lt;-<span class="st"> </span>all_words <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb343-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(author, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) </a></code></pre></div></li>
<li><p>Filter <code>word_cout</code> to only retain “twain”, assign it to <code>twain_most</code></p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" data-line-number="1">twain_most &lt;-<span class="st"> </span>word_count <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb344-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;twain&quot;</span>)</a></code></pre></div></li>
<li><p>Use <code>wordcloud</code> to visualize the top 50 words used by Twain</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb345-1" data-line-number="1">twain_most <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb345-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb345-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb345-4" data-line-number="4"><span class="st">  </span><span class="kw">with</span>(wordcloud<span class="op">::</span><span class="kw">wordcloud</span>(</a>
<a class="sourceLine" id="cb345-5" data-line-number="5">    word, </a>
<a class="sourceLine" id="cb345-6" data-line-number="6">    n,</a>
<a class="sourceLine" id="cb345-7" data-line-number="7">    <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#56B4E9&quot;</span>))</a>
<a class="sourceLine" id="cb345-8" data-line-number="8">    )</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-246-1.png" width="672" /></p></li>
<li><p>Filter <code>word_cout</code> to only retain “doyle”, assign it to <code>doyle_most</code></p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb346-1" data-line-number="1">doyle_most &lt;-<span class="st"> </span>word_count <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb346-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;doyle&quot;</span>)</a></code></pre></div></li>
<li><p>Used <code>wordcloud</code> to visualize the top 50 words used by Doyle that have more than 5 characters</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb347-1" data-line-number="1">doyle_most <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb347-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">nchar</span>(word) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb347-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb347-4" data-line-number="4"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb347-5" data-line-number="5"><span class="st">  </span><span class="kw">with</span>(wordcloud<span class="op">::</span><span class="kw">wordcloud</span>(</a>
<a class="sourceLine" id="cb347-6" data-line-number="6">    word, </a>
<a class="sourceLine" id="cb347-7" data-line-number="7">    n,</a>
<a class="sourceLine" id="cb347-8" data-line-number="8">    <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#56B4E9&quot;</span>)</a>
<a class="sourceLine" id="cb347-9" data-line-number="9">    ))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-248-1.png" width="672" /></p></li>
<li><p>Use <code>anti_join()</code> to figure out which words are used by Doyle but not Twain. Order the results by number of words.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb348-1" data-line-number="1">doyle_unique &lt;-<span class="st"> </span>doyle_most <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb348-2" data-line-number="2"><span class="st">  </span><span class="kw">anti_join</span>(twain_most, <span class="dt">by =</span> <span class="st">&quot;word&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb348-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) </a></code></pre></div></li>
<li><p>Use <code>wordcloud</code> to visualize top 50 records in the previous step</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb349-1" data-line-number="1">doyle_unique <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb349-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb349-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb349-4" data-line-number="4"><span class="st">  </span><span class="kw">with</span>(wordcloud<span class="op">::</span><span class="kw">wordcloud</span>(</a>
<a class="sourceLine" id="cb349-5" data-line-number="5">    word, </a>
<a class="sourceLine" id="cb349-6" data-line-number="6">    n,</a>
<a class="sourceLine" id="cb349-7" data-line-number="7">    <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#56B4E9&quot;</span>))</a>
<a class="sourceLine" id="cb349-8" data-line-number="8">    )</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-250-1.png" width="672" /></p></li>
<li><p>Find out how many times Twain used the word “sherlock”</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb350-1" data-line-number="1">all_words <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb350-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;twain&quot;</span>, word <span class="op">==</span><span class="st"> &quot;sherlock&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb350-3" data-line-number="3"><span class="st">  </span><span class="kw">tally</span>()</a></code></pre></div>
<pre><code>## # Source: spark&lt;?&gt; [?? x 1]
##       n
##   &lt;dbl&gt;
## 1    47</code></pre></li>
<li><p>Against the <code>twain</code> variable, use Hive’s <em>instr</em> and <em>lower</em> to make all ever word lower cap, and then look for “sherlock” in the line</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb352-1" data-line-number="1">twain <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb352-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">line =</span> <span class="kw">lower</span>(line)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb352-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">instr</span>(line, <span class="st">&quot;sherlock&quot;</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb352-4" data-line-number="4"><span class="st">  </span><span class="kw">pull</span>(line)</a></code></pre></div>
<pre><code>##  [1] &quot;late sherlock holmes, and yet discernible by a member of a race charged&quot;  
##  [2] &quot;sherlock holmes.&quot;                                                         
##  [3] &quot;\&quot;uncle sherlock! the mean luck of it!--that he should come just&quot;         
##  [4] &quot;another trouble presented itself. \&quot;uncle sherlock &#39;ll be wanting to talk&quot;
##  [5] &quot;flint buckner&#39;s cabin in the frosty gloom. they were sherlock holmes and&quot; 
##  [6] &quot;\&quot;uncle sherlock&#39;s got some work to do, gentlemen, that &#39;ll keep him till&quot;
##  [7] &quot;\&quot;by george, he&#39;s just a duke, boys! three cheers for sherlock holmes,&quot;   
##  [8] &quot;he brought sherlock holmes to the billiard-room, which was jammed with&quot;   
##  [9] &quot;of interest was there--sherlock holmes. the miners stood silent and&quot;      
## [10] &quot;the room; the chair was on it; sherlock holmes, stately, imposing,&quot;       
## [11] &quot;\&quot;you have hunted me around the world, sherlock holmes, yet god is my&quot;    
## [12] &quot;\&quot;if it&#39;s only sherlock holmes that&#39;s troubling you, you needn&#39;t worry&quot;   
## [13] &quot;they sighed; then one said: \&quot;we must bring sherlock holmes. he can be&quot;   
## [14] &quot;i had small desire that sherlock holmes should hang for my deeds, as you&quot; 
## [15] &quot;\&quot;my name is sherlock holmes, and i have not been doing anything.\&quot;&quot;      
## [16] &quot;late sherlock holmes, and yet discernible by a member of a race charged&quot;  
## [17] &quot;plus fort que sherlock holmes&quot;                                            
## [18] &quot;sherlock holmes entre en scene&quot;                                           
## [19] &quot;sherlock holmes&quot;                                                          
## [20] &quot;--l&#39;oncle sherlock! quelle guigne!&quot;                                       
## [21] &quot;bien! cette fois sherlock sera tres embarrasse; il manquera de preuve et&quot; 
## [22] &quot;--l&#39;oncle sherlock va vouloir, ce soir, causer avec moi de notre&quot;         
## [23] &quot;passage etroit sur la chambre de sherlock holmes; ils s&#39;y embusquerent&quot;   
## [24] &quot;d&#39;archy, il ne peut etre nullement compare au genie de sherlock holmes,&quot;  
## [25] &quot;flint buckner. c&#39;etait sherlock holmes et son neveu.&quot;                     
## [26] &quot;--messieurs, mon oncle sherlock a un travail pressant a faire qui le&quot;     
## [27] &quot;--mes amis! trois vivats a sherlock holmes, le plus grand homme qui ait&quot;  
## [28] &quot;mettaient de coeur a leur reception. arrive dans sa chambre, sherlock&quot;    
## [29] &quot;il introduisit sherlock holmes dans la salle de billard qui etait comble&quot; 
## [30] &quot;de mineurs, tous impatients de le voir arriver. sherlock commanda les&quot;    
## [31] &quot;sherlock holmes. les mineurs se tenaient en demi-cercle en observant un&quot;  
## [32] &quot;sherlock au milieu de nous? dit ferguson.&quot;                                
## [33] &quot;arracher; quand sherlock y met la main, il faut qu&#39;ils parlent, qu&#39;ils&quot;   
## [34] &quot;plus complexe; sherlock va pouvoir etaler devant nous son art et sa&quot;      
## [35] &quot;regardant comment sherlock procede. mais non, au lieu de cela, il a&quot;      
## [36] &quot;sherlock holmes etait assis sur cette chaise, l&#39;air grave, imposant et&quot;   
## [37] &quot;sherlock holmes leva la main pour concentrer sur lui l&#39;attention du&quot;      
## [38] &quot;pas baisse pavillon devant sherlock holmes.\&quot; la serenite de ce dernier&quot;  
## [39] &quot;objets, il y a une heure a peine pendant que maitre sherlock holmes se&quot;   
## [40] &quot;sherlock regardait avec la volonte bien arretee de conserver son&quot;         
## [41] &quot;silence complet qui suivit, maitre sherlock prit la parole, disant avec&quot;  
## [42] &quot;--vous m&#39;avez pourchasse dans tout l&#39;univers, sherlock holmes, et&quot;        
## [43] &quot;--si c&#39;est uniquement sherlock holmes qui vous inquiete, inutile de vous&quot; 
## [44] &quot;\&quot;elles soupirerent, puis l&#39;une dit: \&quot;il faut que nous amenions sherlock&quot;
## [45] &quot;d&#39;assister de sang-froid a la pendaison de sherlock holmes. j&#39;avais&quot;      
## [46] &quot;--je m&#39;appelle sherlock holmes; je n&#39;ai rien a me reprocher.&quot;             
## [47] &quot;plus fort que sherlock holmes&quot;</code></pre></li>
<li><p>Close Spark session</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb354-1" data-line-number="1"><span class="kw">spark_disconnect</span>(sc)</a></code></pre></div></li>
</ol>
<p>Most of these lines are in a short story by Mark Twain called <a href="https://www.gutenberg.org/files/3180/3180-h/3180-h.htm#link2H_4_0008">A Double Barrelled Detective Story</a>. As per the <a href="https://en.wikipedia.org/wiki/A_Double_Barrelled_Detective_Story">Wikipedia</a> page about this story, this is a satire by Twain on the mystery novel genre, published in 1902.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro-to-sparklyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spark-data-caching.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
